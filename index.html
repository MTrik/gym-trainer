<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<!-- SEO Meta Tags -->
<meta name="description" content="–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä –¥–ª—è —Å–ø–æ—Ä—Ç–∑–∞–ª–∞ —Å —Ç–∞–π–º–µ—Ä–æ–º –æ—Ç–¥—ã—Ö–∞, –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞">
<meta name="keywords" content="—Ñ–∏—Ç–Ω–µ—Å, —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, —Å–ø–æ—Ä—Ç–∑–∞–ª, —Ç–∞–π–º–µ—Ä, PWA, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä">
<meta name="author" content="Gym Trainer App">

<!-- PWA Manifest -->
<link rel="manifest" href="#" id="manifest-placeholder">

<!-- Apple PWA Meta Tags -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Gym Trainer">
<meta name="apple-touch-fullscreen" content="yes">

<!-- iOS Icons -->
<link rel="apple-touch-icon" sizes="180x180" href="#" id="icon-180">
<link rel="apple-touch-icon" sizes="167x167" href="#" id="icon-167">
<link rel="apple-touch-icon" sizes="152x152" href="#" id="icon-152">
<link rel="apple-touch-icon" sizes="120x120" href="#" id="icon-120">

<!-- Android PWA -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#3b82f6">
<meta name="background-color" content="#ffffff">

<!-- Microsoft Tiles -->
<meta name="msapplication-TileColor" content="#3b82f6">
<meta name="msapplication-TileImage" content="#" id="ms-tile">

<!-- Favicons -->
<link rel="icon" type="image/png" sizes="32x32" href="#" id="favicon-32">
<link rel="icon" type="image/png" sizes="16x16" href="#" id="favicon-16">

<title>Gym Trainer - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä</title>

<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
-webkit-tap-highlight-color: transparent;
}

body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: #f3f4f6;
color: #111827;
overflow-x: hidden;
-webkit-user-select: none;
user-select: none;
-webkit-touch-callout: none;
position: fixed;
width: 100%;
height: 100vh;
height: 100dvh;
}

.app {
width: 100%;
height: 100vh;
height: 100dvh;
display: flex;
flex-direction: column;
background: white;
max-width: 768px;
margin: 0 auto;
}

.header {
background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
color: white;
padding: env(safe-area-inset-top, 20px) 1rem 1rem 1rem;
flex-shrink: 0;
}

.header h1 {
font-size: 1.5rem;
margin-bottom: 0.25rem;
font-weight: 700;
}

.header p {
font-size: 0.875rem;
opacity: 0.9;
}

.nav {
background: white;
display: flex;
border-bottom: 1px solid #e5e7eb;
flex-shrink: 0;
}

.nav button {
flex: 1;
padding: 0.75rem 0.5rem;
background: none;
border: none;
font-size: 0.7rem;
font-weight: 600;
color: #6b7280;
cursor: pointer;
position: relative;
transition: all 0.2s ease;
}

.nav button:active {
transform: scale(0.95);
}

.nav button.active {
color: #3b82f6;
background: #eff6ff;
}

.nav button.active::after {
content: '';
position: absolute;
bottom: 0;
left: 0;
right: 0;
height: 3px;
background: linear-gradient(90deg, #3b82f6, #8b5cf6);
border-radius: 2px 2px 0 0;
}

.content {
flex: 1;
overflow-y: auto;
-webkit-overflow-scrolling: touch;
padding: 1rem;
padding-bottom: calc(1rem + env(safe-area-inset-bottom));
}

.tab-content {
display: none;
animation: fadeIn 0.3s ease-in-out;
}

.tab-content.active {
display: block;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}

.timer-display {
text-align: center;
padding: 2rem 0;
}

.timer-time {
font-size: clamp(3rem, 8vw, 4.5rem);
font-weight: 700;
font-family: 'SF Mono', Monaco, monospace;
margin-bottom: 1rem;
background: linear-gradient(135deg, #3b82f6, #8b5cf6);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.timer-time.warning {
background: linear-gradient(135deg, #ef4444, #dc2626);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
animation: pulse 1s infinite;
}

@keyframes pulse {
0%, 100% { opacity: 1; transform: scale(1); }
50% { opacity: 0.8; transform: scale(1.05); }
}

.btn {
padding: 0.875rem 1.5rem;
border: none;
border-radius: 12px;
font-weight: 600;
font-size: 0.875rem;
cursor: pointer;
margin: 0.25rem;
touch-action: manipulation;
transition: all 0.2s ease;
}

.btn:active {
transform: scale(0.95);
}

.btn-primary {
background: linear-gradient(135deg, #10b981, #059669);
color: white;
box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.btn-secondary {
background: linear-gradient(135deg, #6b7280, #4b5563);
color: white;
box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
}

.btn-info {
background: linear-gradient(135deg, #3b82f6, #2563eb);
color: white;
box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.workout-selector {
display: grid;
grid-template-columns: repeat(4, 1fr);
gap: 0.5rem;
margin-bottom: 1.5rem;
}

.workout-btn {
padding: 0.75rem 0.5rem;
border: 2px solid #e5e7eb;
border-radius: 12px;
background: white;
cursor: pointer;
text-align: center;
font-size: 0.75rem;
font-weight: 600;
transition: all 0.2s ease;
box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.workout-btn:active {
transform: scale(0.95);
}

.workout-btn.active {
background: linear-gradient(135deg, #3b82f6, #8b5cf6);
color: white;
border-color: transparent;
box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.exercise-card {
background: linear-gradient(135deg, #eff6ff 0%, #f3e8ff 100%);
border-radius: 16px;
padding: 1.5rem;
margin-bottom: 1rem;
border: 1px solid #c7d2fe;
box-shadow: 0 4px 16px rgba(0,0,0,0.05);
}

.exercise-item {
padding: 1rem;
background: white;
border: 2px solid #e5e7eb;
border-radius: 12px;
margin-bottom: 0.75rem;
transition: all 0.2s ease;
box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.exercise-item:active {
transform: scale(0.98);
}

.exercise-item.current {
border-color: #3b82f6;
background: linear-gradient(135deg, #eff6ff, #f0f9ff);
box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15);
}

.exercise-item.completed {
border-color: #10b981;
background: linear-gradient(135deg, #d1fae5, #ecfdf5);
box-shadow: 0 4px 16px rgba(16, 185, 129, 0.15);
}

.set-dots {
display: flex;
gap: 0.375rem;
margin-top: 0.75rem;
flex-wrap: wrap;
}

.set-dot {
width: 28px;
height: 28px;
border-radius: 50%;
background: #e5e7eb;
display: flex;
align-items: center;
justify-content: center;
font-size: 0.75rem;
font-weight: 600;
transition: all 0.2s ease;
border: 2px solid transparent;
}

.set-dot.completed {
background: linear-gradient(135deg, #10b981, #059669);
color: white;
border-color: #10b981;
transform: scale(1.05);
}

.stats-grid {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 0.75rem;
margin-bottom: 1.5rem;
}

.stat-card {
text-align: center;
padding: 1rem;
background: linear-gradient(135deg, #f9fafb, #f3f4f6);
border-radius: 12px;
border: 1px solid #e5e7eb;
}

.stat-value {
font-size: 1.75rem;
font-weight: 700;
background: linear-gradient(135deg, #3b82f6, #8b5cf6);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.stat-label {
font-size: 0.75rem;
color: #6b7280;
font-weight: 500;
margin-top: 0.25rem;
}

.schedule-item {
background: white;
border: 1px solid #e5e7eb;
border-radius: 12px;
padding: 1rem;
margin-bottom: 0.75rem;
transition: all 0.2s ease;
box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.schedule-item:active {
transform: scale(0.98);
}

.schedule-item.today {
border-color: #3b82f6;
background: linear-gradient(135deg, #eff6ff, #f0f9ff);
box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15);
}

.schedule-item.rest {
background: linear-gradient(135deg, #f3f4f6, #f9fafb);
color: #6b7280;
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
body { background: #111827; color: #f9fafb; }
.app { background: #1f2937; }
.nav { background: #1f2937; border-color: #374151; }
.exercise-item { background: #374151; border-color: #4b5563; color: #f9fafb; }
.schedule-item { background: #374151; border-color: #4b5563; color: #f9fafb; }
}
</style>
</head>
<body>
<div class="app">
<div class="header">
<h1>üèãÔ∏è Gym Trainer</h1>
<p>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä</p>
<div style="margin-top: 0.5rem; font-size: 0.75rem; opacity: 0.9;">
–ü—Ä–æ–≥—Ä–∞–º–º–∞ <span id="currentWorkout">–ê</span>: <span id="workoutName">–í–µ—Ä—Ö —Ç–µ–ª–∞ + –ì—Ä—É–¥—å-–ü–ª–µ—á–∏-–¢—Ä–∏—Ü–µ–ø—Å</span>
</div>
</div>

<nav class="nav">
<button class="active" onclick="switchTab('timer', this)">‚è±Ô∏è<br>–¢–∞–π–º–µ—Ä</button>
<button onclick="switchTab('workout', this)">üéØ<br>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</button>
<button onclick="switchTab('calculator', this)">üßÆ<br>–í–µ—Å–∞</button>
<button onclick="switchTab('schedule', this)">üìÖ<br>–ü–ª–∞–Ω</button>
<button onclick="switchTab('history', this)">üìä<br>–ò—Å—Ç–æ—Ä–∏—è</button>
</nav>

<div class="content">
<!-- Timer Tab -->
<div id="timer" class="tab-content active">
<div class="timer-display">
<div id="timerDisplay" class="timer-time">1:30</div>
<div style="color: #6b7280; margin-bottom: 1.5rem;">–û—Ç–¥—ã—Ö –º–µ–∂–¥—É –ø–æ–¥—Ö–æ–¥–∞–º–∏</div>
<div>
<button id="timerBtn" class="btn btn-primary" onclick="toggleTimer()">‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç</button>
<button class="btn btn-secondary" onclick="resetTimer()">üîÑ –°–±—Ä–æ—Å</button>
</div>
<div style="margin-top: 1.5rem;">
<button class="btn btn-info" onclick="setTimer(60)">60—Å</button>
<button class="btn btn-info" onclick="setTimer(90)">90—Å</button>
<button class="btn btn-info" onclick="setTimer(120)">120—Å</button>
</div>
</div>
</div>

<!-- Workout Tab -->
<div id="workout" class="tab-content">
<div class="workout-selector" id="workoutSelector"></div>
<div id="currentExerciseCard"></div>
<div id="exerciseList"></div>
</div>

<!-- Calculator Tab -->
<div id="calculator" class="tab-content">
<h3 style="margin-bottom: 1.5rem;">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–µ—Å–æ–≤</h3>
<div id="calculatorList"></div>
</div>

<!-- Schedule Tab -->
<div id="schedule" class="tab-content">
<h3 style="margin-bottom: 1.5rem;">–ù–µ–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω</h3>
<div id="scheduleList"></div>
</div>

<!-- History Tab -->
<div id="history" class="tab-content">
<h3 style="margin-bottom: 1.5rem;">–ò—Å—Ç–æ—Ä–∏—è</h3>
<div class="stats-grid">
<div class="stat-card">
<div id="totalSets" class="stat-value">0</div>
<div class="stat-label">–ü–æ–¥—Ö–æ–¥–æ–≤</div>
</div>
<div class="stat-card">
<div id="totalDays" class="stat-value">0</div>
<div class="stat-label">–î–Ω–µ–π</div>
</div>
<div class="stat-card">
<div id="totalWeight" class="stat-value">0</div>
<div class="stat-label">–¢–æ–Ω–Ω–∞–∂</div>
</div>
</div>
<div id="historyList"></div>
</div>
</div>
</div>

<script>
// PWA Features
let deferredPrompt;

// Generate PWA Manifest
const manifest = {
name: "Gym Trainer - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä",
short_name: "Gym Trainer",
description: "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä –¥–ª—è —Å–ø–æ—Ä—Ç–∑–∞–ª–∞",
start_url: "./",
display: "standalone",
background_color: "#ffffff",
theme_color: "#3b82f6",
orientation: "portrait",
icons: generateIcons()
};

function generateIcon(size) {
const canvas = document.createElement('canvas');
canvas.width = size;
canvas.height = size;
const ctx = canvas.getContext('2d');

const gradient = ctx.createLinearGradient(0, 0, size, size);
gradient.addColorStop(0, '#3b82f6');
gradient.addColorStop(1, '#8b5cf6');
ctx.fillStyle = gradient;
ctx.fillRect(0, 0, size, size);

ctx.font = `${size * 0.5}px system-ui`;
ctx.textAlign = 'center';
ctx.textBaseline = 'middle';
ctx.fillStyle = '#ffffff';
ctx.fillText('üèãÔ∏è', size / 2, size / 2);

return canvas.toDataURL();
}

function generateIcons() {
const sizes = [72, 96, 128, 144, 152, 192, 384, 512];
return sizes.map(size => ({
src: generateIcon(size),
sizes: `${size}x${size}`,
type: "image/png"
}));
}

// Setup PWA
function setupPWA() {
const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
const manifestURL = URL.createObjectURL(manifestBlob);
document.getElementById('manifest-placeholder').href = manifestURL;

document.getElementById('icon-180').href = generateIcon(180);
document.getElementById('icon-167').href = generateIcon(167);
document.getElementById('icon-152').href = generateIcon(152);
document.getElementById('icon-120').href = generateIcon(120);
document.getElementById('favicon-32').href = generateIcon(32);
document.getElementById('favicon-16').href = generateIcon(16);
}

// Service Worker
if ('serviceWorker' in navigator) {
window.addEventListener('load', () => {
const swCode = `
const CACHE_NAME = 'gym-trainer-v1';
self.addEventListener('install', event => {
self.skipWaiting();
});
self.addEventListener('fetch', event => {
event.respondWith(
caches.match(event.request).then(response => {
return response || fetch(event.request);
})
);
});
`;

const swBlob = new Blob([swCode], { type: 'application/javascript' });
const swURL = URL.createObjectURL(swBlob);
navigator.serviceWorker.register(swURL);
});
}

// Programs
const workoutPrograms = {
'–ê': {
name: '–í–µ—Ä—Ö —Ç–µ–ª–∞ + –ì—Ä—É–¥—å-–ü–ª–µ—á–∏-–¢—Ä–∏—Ü–µ–ø—Å',
exercises: [
{ name: 'Chest Press / –ñ–∏–º –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ', sets: 4, reps: '10-12', weight: 22.5, rest: 120 },
{ name: 'Lat Machine / –¢—è–≥–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞', sets: 3, reps: '10-12', weight: 25, rest: 90 },
{ name: 'Shoulder Press / –ñ–∏–º –Ω–∞ –ø–ª–µ—á–∏', sets: 4, reps: '10-12', weight: 17.5, rest: 90 },
{ name: '–ñ–∏–º –≤ –°–º–∏—Ç–µ', sets: 4, reps: '10-12', weight: 20, rest: 120 },
{ name: '–°–≤–µ–¥–µ–Ω–∏–µ –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ', sets: 3, reps: '15', weight: 15, rest: 60 },
{ name: '–ú–∞—Ö–∏ –≤ —Å—Ç–æ—Ä–æ–Ω—ã', sets: 3, reps: '15', weight: 10, rest: 60 },
{ name: '–ë–∏—Ü–µ–ø—Å (Pulley)', sets: 3, reps: '12-15', weight: 10, rest: 60 },
{ name: '–¢—Ä–∏—Ü–µ–ø—Å (Pulley)', sets: 3, reps: '12-15', weight: 10, rest: 60 },
{ name: '–†–∞–∑–≥–∏–±–∞–Ω–∏–µ –Ω–∞ –±–ª–æ–∫–µ', sets: 3, reps: '15', weight: 10, rest: 60 },
{ name: '–ü–ª–∞–Ω–∫–∞', sets: 3, reps: '30-45—Å', weight: 0, rest: 60 }
]
},
'–ë': {
name: '–°–ø–∏–Ω–∞-–ë–∏—Ü–µ–ø—Å + –ö–∞—Ä–¥–∏–æ',
exercises: [
{ name: '–ë–µ–≥–æ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞', sets: 1, reps: '10 –º–∏–Ω', weight: 0, rest: 60 },
{ name: '–ì—Ä–µ–±–Ω–æ–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä', sets: 1, reps: '8 –º–∏–Ω', weight: 0, rest: 60 },
{ name: '–°—Ç–µ–ø–ø–µ—Ä', sets: 1, reps: '5 –º–∏–Ω', weight: 0, rest: 60 },
{ name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è/–¢—è–≥–∞ –±–ª–æ–∫–∞', sets: 4, reps: '8-10', weight: 25, rest: 90 },
{ name: '–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ', sets: 4, reps: '10-12', weight: 20, rest: 90 },
{ name: '–¢—è–≥–∞ –≥–∞–Ω—Ç–µ–ª–∏', sets: 3, reps: '12', weight: 15, rest: 90 },
{ name: '–ü–æ–¥—ä–µ–º –Ω–∞ –±–∏—Ü–µ–ø—Å', sets: 4, reps: '10-12', weight: 15, rest: 60 },
{ name: '–ú–æ–ª–æ—Ç–∫–∏', sets: 3, reps: '15', weight: 10, rest: 60 }
]
},
'–í': {
name: '–ù–æ–≥–∏-–ü—Ä–µ—Å—Å',
exercises: [
{ name: '–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è', sets: 4, reps: '10-12', weight: 30, rest: 120 },
{ name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', sets: 3, reps: '12-15', weight: 40, rest: 90 },
{ name: '–†–∞–∑–≥–∏–±–∞–Ω–∏—è –Ω–æ–≥', sets: 3, reps: '12-15', weight: 25, rest: 60 },
{ name: '–°–≥–∏–±–∞–Ω–∏—è –Ω–æ–≥', sets: 3, reps: '12-15', weight: 20, rest: 60 },
{ name: '–ü–æ–¥—ä–µ–º—ã –Ω–∞ –Ω–æ—Å–∫–∏', sets: 4, reps: '20', weight: 20, rest: 60 },
{ name: '–ü–ª–∞–Ω–∫–∞', sets: 3, reps: '60—Å', weight: 0, rest: 60 },
{ name: '–°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è', sets: 3, reps: '20', weight: 0, rest: 60 }
]
},
'–ì': {
name: '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è + –°–∏–ª–æ–≤–∞—è',
exercises: [
{ name: '–ë–µ–≥–æ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞', sets: 1, reps: '10 –º–∏–Ω', weight: 0, rest: 60 },
{ name: '–≠–ª–ª–∏–ø—Å', sets: 1, reps: '10 –º–∏–Ω', weight: 0, rest: 60 },
{ name: 'TRX', sets: 3, reps: '30—Å', weight: 0, rest: 60 },
{ name: '–ö–∏–Ω–µ–∑–∏—Å', sets: 3, reps: '12', weight: 10, rest: 60 },
{ name: '–ë–æ—Å—É', sets: 2, reps: '1 –º–∏–Ω', weight: 0, rest: 60 },
{ name: '–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–∏–ª–æ–≤—ã–µ', sets: 4, reps: '6-8', weight: 40, rest: 150 },
{ name: 'Chest Press —Å–∏–ª–æ–≤–æ–π', sets: 4, reps: '6-8', weight: 30, rest: 150 },
{ name: '–†–∞—Å—Ç—è–∂–∫–∞', sets: 1, reps: '5 –º–∏–Ω', weight: 0, rest: 0 }
]
}
};

// State
let currentWorkout = '–ê';
let currentExercise = 0;
let currentSet = 1;
let completedSets = [];
let timerSeconds = 90;
let timerRunning = false;
let timerInterval = null;
let weights = {};
let workoutHistory = [];

// Initialize
function init() {
setupPWA();
loadData();
renderWorkout();
renderCalculator();
renderSchedule();
renderHistory();
}

// Storage
function loadData() {
try {
const saved = localStorage.getItem('gymTrainerData');
if (saved) {
const data = JSON.parse(saved);
weights = data.weights || {};
workoutHistory = data.history || [];
}
} catch (e) {}
updateHeader();
}

function saveData() {
try {
localStorage.setItem('gymTrainerData', JSON.stringify({
weights: weights,
history: workoutHistory
}));
} catch (e) {}
}

// Timer
function formatTime(seconds) {
const mins = Math.floor(seconds / 60);
const secs = seconds % 60;
return `${mins}:${secs.toString().padStart(2, '0')}`;
}

function updateTimerDisplay() {
const display = document.getElementById('timerDisplay');
const btn = document.getElementById('timerBtn');
display.textContent = formatTime(timerSeconds);

if (timerSeconds <= 10 && timerRunning) {
display.classList.add('warning');
} else {
display.classList.remove('warning');
}

btn.innerHTML = timerRunning ? '‚è∏Ô∏è –ü–∞—É–∑–∞' : '‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç';
}

function toggleTimer() {
if (timerRunning) {
clearInterval(timerInterval);
timerRunning = false;
} else {
timerRunning = true;
timerInterval = setInterval(() => {
timerSeconds--;
if (timerSeconds <= 0) {
timerSeconds = 0;
clearInterval(timerInterval);
timerRunning = false;
if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
}
updateTimerDisplay();
}, 1000);
}
updateTimerDisplay();
}

function resetTimer() {
clearInterval(timerInterval);
timerRunning = false;
timerSeconds = 90;
updateTimerDisplay();
}

function setTimer(seconds) {
clearInterval(timerInterval);
timerRunning = false;
timerSeconds = seconds;
updateTimerDisplay();
toggleTimer();
}

// Tabs
function switchTab(tabName, btn) {
document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
btn.classList.add('active');
document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
document.getElementById(tabName).classList.add('active');
}

// Header
function updateHeader() {
document.getElementById('currentWorkout').textContent = currentWorkout;
document.getElementById('workoutName').textContent = workoutPrograms[currentWorkout].name;
}

// Workout
function selectWorkout(workout) {
currentWorkout = workout;
currentExercise = 0;
currentSet = 1;
completedSets = [];
updateHeader();
renderWorkout();
saveData();
}

function completeSet() {
const program = workoutPrograms[currentWorkout];
const exercise = program.exercises[currentExercise];

completedSets.push(`${currentWorkout}-${currentExercise}-${currentSet}`);

workoutHistory.push({
date: new Date().toLocaleDateString('ru-RU'),
exercise: exercise.name,
set: currentSet,
weight: weights[exercise.name] || exercise.weight,
reps: exercise.reps
});

saveData();

if (currentSet < exercise.sets) {
currentSet++;
} else {
if (currentExercise < program.exercises.length - 1) {
currentExercise++;
currentSet = 1;
} else {
alert('üéâ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
}
}

renderWorkout();
const restTime = exercise.rest || 90;
setTimer(restTime);
switchTab('timer', document.querySelector('.nav button'));
}

function renderWorkout() {
const selector = document.getElementById('workoutSelector');
const exerciseCard = document.getElementById('currentExerciseCard');
const exerciseList = document.getElementById('exerciseList');

selector.innerHTML = Object.keys(workoutPrograms).map(key => 
`<button class="workout-btn ${key === currentWorkout ? 'active' : ''}" 
onclick="selectWorkout('${key}')">
${key}: ${workoutPrograms[key].name.split(' ')[0]}
</button>`
).join('');

const program = workoutPrograms[currentWorkout];
const exercise = program.exercises[currentExercise];

exerciseCard.innerHTML = `
<div class="exercise-card">
<h3>${exercise.name}</h3>
<p>–ü–æ–¥—Ö–æ–¥ ${currentSet} –∏–∑ ${exercise.sets} ‚Ä¢ ${exercise.reps} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</p>
<p style="color: #6b7280;">–í–µ—Å: ${weights[exercise.name] || exercise.weight} –∫–≥ ‚Ä¢ –û—Ç–¥—ã—Ö: ${exercise.rest}—Å</p>
<div class="set-dots">
${Array.from({length: exercise.sets}, (_, i) => {
const setNum = i + 1;
const isCompleted = completedSets.includes(`${currentWorkout}-${currentExercise}-${setNum}`);
return `<div class="set-dot ${isCompleted ? 'completed' : ''}">${setNum}</div>`;
}).join('')}
</div>
<button class="btn btn-primary" onclick="completeSet()" style="margin-top: 1rem; width: 100%;">
‚úì –ü–æ–¥—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω
</button>
</div>
`;

exerciseList.innerHTML = program.exercises.map((ex, index) => {
const isCurrent = index === currentExercise;
const completedCount = completedSets.filter(s => s.startsWith(`${currentWorkout}-${index}-`)).length;
const isCompleted = completedCount === ex.sets;
return `
<div class="exercise-item ${isCurrent ? 'current' : ''} ${isCompleted ? 'completed' : ''}">
<div style="display: flex; justify-content: space-between; align-items: center;">
<div>
<strong>${ex.name}</strong>
<div style="font-size: 0.75rem; color: #6b7280;">
${ex.sets}√ó${ex.reps} ‚Ä¢ ${weights[ex.name] || ex.weight}–∫–≥ ‚Ä¢ ${ex.rest}—Å
</div>
</div>
<div style="color: ${isCompleted ? '#10b981' : isCurrent ? '#3b82f6' : '#6b7280'}; font-size: 1.25rem;">
${isCompleted ? '‚úÖ' : isCurrent ? 'üéØ' : '‚è≥'}
</div>
</div>
</div>
`;
}).join('');
}

// Calculator
function renderCalculator() {
const calculatorList = document.getElementById('calculatorList');
const allExercises = Object.values(workoutPrograms).flatMap(p => p.exercises);
const uniqueExercises = [...new Set(allExercises.map(e => e.name))];

calculatorList.innerHTML = uniqueExercises.map(name => {
const defaultWeight = allExercises.find(e => e.name === name)?.weight || 0;
const currentWeight = weights[name] || defaultWeight;
return `
<div class="exercise-item">
<div style="display: flex; justify-content: space-between; align-items: center;">
<div>
<strong>${name}</strong>
<div style="font-size: 0.75rem; color: #6b7280;">–†–∞–±–æ—á–∏–π –≤–µ—Å</div>
</div>
<div style="display: flex; align-items: center; gap: 0.75rem;">
<button class="btn btn-secondary" onclick="updateWeight('${name}', -2.5)" 
style="padding: 0.5rem;">‚àí</button>
<span style="min-width: 60px; text-align: center; font-weight: 600;">${currentWeight}–∫–≥</span>
<button class="btn btn-primary" onclick="updateWeight('${name}', 2.5)" 
style="padding: 0.5rem;">+</button>
</div>
</div>
</div>
`;
}).join('');
}

function updateWeight(exerciseName, delta) {
const current = weights[exerciseName] || 0;
weights[exerciseName] = Math.max(0, current + delta);
saveData();
renderCalculator();
renderWorkout();
}

// Schedule
function renderSchedule() {
const scheduleList = document.getElementById('scheduleList');
const today = new Date().getDay();

const schedule = [
{ day: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', program: '–ê', focus: '–í–µ—Ä—Ö —Ç–µ–ª–∞', dayIndex: 1 },
{ day: '–í—Ç–æ—Ä–Ω–∏–∫', program: '–í', focus: '–ù–æ–≥–∏', dayIndex: 2 },
{ day: '–°—Ä–µ–¥–∞', program: null, focus: '–û—Ç–¥—ã—Ö', dayIndex: 3 },
{ day: '–ß–µ—Ç–≤–µ—Ä–≥', program: '–ë', focus: '–°–ø–∏–Ω–∞ + –ö–∞—Ä–¥–∏–æ', dayIndex: 4 },
{ day: '–ü—è—Ç–Ω–∏—Ü–∞', program: '–ê', focus: '–í–µ—Ä—Ö —Ç–µ–ª–∞', dayIndex: 5 },
{ day: '–°—É–±–±–æ—Ç–∞', program: '–ì', focus: '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è', dayIndex: 6 },
{ day: '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', program: null, focus: '–û—Ç–¥—ã—Ö', dayIndex: 0 }
];

scheduleList.innerHTML = schedule.map(item => {
const isToday = item.dayIndex === today;
const isRest = !item.program;
return `
<div class="schedule-item ${isToday ? 'today' : ''} ${isRest ? 'rest' : ''}">
<div style="display: flex; justify-content: space-between; align-items: center;">
<div>
<strong>${item.day}${isToday ? ' (–°–µ–≥–æ–¥–Ω—è)' : ''}</strong>
<div style="font-size: 0.875rem; opacity: 0.8;">${item.focus}</div>
</div>
<div style="font-size: 1.25rem;">
${item.program ? `–ü—Ä–æ–≥—Ä–∞–º–º–∞ ${item.program}` : 'üò¥'}
</div>
</div>
${item.program && !isRest ? `
<button class="btn btn-info" onclick="selectWorkout('${item.program}'); switchTab('workout', document.querySelectorAll('.nav button')[1])" 
style="margin-top: 0.75rem; width: 100%;">
üéØ –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
</button>` : ''}
</div>
`;
}).join('');
}

// History
function renderHistory() {
const totalSets = document.getElementById('totalSets');
const totalDays = document.getElementById('totalDays');
const totalWeight = document.getElementById('totalWeight');
const historyList = document.getElementById('historyList');

const uniqueDays = [...new Set(workoutHistory.map(h => h.date))].length;
const totalTonnage = workoutHistory.reduce((sum, h) => {
const weight = parseFloat(h.weight) || 0;
const reps = parseFloat(h.reps) || 1;
return sum + (weight * reps);
}, 0);

totalSets.textContent = workoutHistory.length;
totalDays.textContent = uniqueDays;
totalWeight.textContent = Math.round(totalTonnage);

const recent = workoutHistory.slice(-10).reverse();
historyList.innerHTML = recent.length ? recent.map(h => `
<div class="exercise-item">
<div style="display: flex; justify-content: space-between; align-items: center;">
<div>
<strong>${h.exercise}</strong>
<div style="font-size: 0.75rem; color: #6b7280;">${h.date}</div>
</div>
<div style="text-align: right;">
<div>${h.weight}–∫–≥ √ó ${h.reps}</div>
<div style="font-size: 0.75rem; color: #6b7280;">–ü–æ–¥—Ö–æ–¥ ${h.set}</div>
</div>
</div>
</div>
`).join('') : '<div style="text-align: center; color: #6b7280; padding: 2rem;">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ –ø—É—Å—Ç–∞</div>';
}

// Initialize
init();

// Events
document.addEventListener('visibilitychange', () => {
if (!document.hidden) { loadData(); renderHistory(); }
});

window.addEventListener('beforeunload', saveData);
</script>
</body>
</html>
